<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checklist Audit - Antunez - SCI ANAUJA</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
            line-height: 1.6;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { font-size: 26px; margin-bottom: 10px; }
        .centrale-info {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: left;
        }
        .centrale-info p { margin: 5px 0; font-size: 14px; }
        .info-section {
            padding: 25px;
            background: #f8f9fa;
            border-bottom: 3px solid #e9ecef;
        }
        .info-section input, .info-section select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 8px 0;
            font-size: 14px;
        }
        .section {
            padding: 25px;
            border-bottom: 2px solid #e9ecef;
        }
        .section-header {
            font-size: 20px;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #2ecc71;
            font-weight: 700;
        }
        .check-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 8px;
            border-left: 4px solid #95a5a6;
            transition: all 0.3s;
        }
        .check-item.checked {
            background: #d4edda;
            border-left-color: #2ecc71;
        }
        .check-item.critique {
            border-left-color: #e74c3c;
            background: #ffe6e6;
        }
        .check-item label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        .check-item input[type="checkbox"] {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            cursor: pointer;
        }
        .check-item textarea {
            width: 100%;
            min-height: 60px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-top: 10px;
            font-family: inherit;
            resize: vertical;
        }
        .photo-zone {
            margin: 20px 0;
            padding: 25px;
            background: white;
            border: 3px dashed #2ecc71;
            border-radius: 10px;
            text-align: center;
        }
        .photo-zone input[type="file"] { display: none; }
        .btn-upload {
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-upload:hover { background: #27ae60; transform: translateY(-2px); }
        .photo-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }
        .photo-preview img {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 10px;
            border: 3px solid #2ecc71;
            cursor: pointer;
        }
        .photo-stats {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            font-weight: 600;
        }
        .btn-export {
            width: 100%;
            padding: 20px;
            font-size: 18px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            margin: 20px 0;
            transition: all 0.3s;
        }
        .btn-export:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }
        .footer {
            padding: 25px;
            background: #2c3e50;
            color: white;
            text-align: center;
            font-size: 13px;
        }
        .alert { padding: 15px; border-radius: 10px; margin: 15px 0; }
        .alert-warning { background: #fff3cd; border-left: 4px solid #ffc107; color: #856404; }
        .alert-info { background: #d1ecf1; border-left: 4px solid #17a2b8; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîÜ CHECKLIST AUDIT PV</h1>
            <h2>Antunez - SCI ANAUJA</h2>
            <div class="centrale-info">
                <p><strong>ID Centrale:</strong> 31971</p>
                <p><strong>Puissance:</strong> 269.45 kWc</p>
                <p><strong>Type:</strong> Ombri√®re simple</p>
                <p><strong>D√©partement:</strong> 34</p>
                <p><strong>Adresse:</strong> 253 Bd Robert Koch, 34500 B√©ziers, France</p>
                <p><strong>Audit toiture:</strong> ‚ùå NON (audit visuel seulement)</p>
            </div>
        </div>
        
        <div class="info-section">
            <h3 style="margin-bottom: 15px; color: #2c3e50;">üìù Informations Intervention</h3>
            <input type="text" id="auditeur" placeholder="Nom auditeur / technicien *" required>
            <input type="date" id="date" required>
            <select id="meteo">
                <option value="">Conditions m√©t√©o *</option>
                <option value="Ensoleill√©">‚òÄÔ∏è Ensoleill√©</option>
                <option value="Nuageux">‚õÖ Nuageux</option>
                <option value="Couvert">‚òÅÔ∏è Couvert</option>
                <option value="Pluie">üåßÔ∏è Pluie</option>
            </select>
            <input type="text" id="temperature" placeholder="Temp√©rature ambiante (¬∞C)">
        </div>

        <div class="section">
            <div class="section-header">üéí 1. PR√âPARATION INTERVENTION</div>

            <div class="check-item " id="item_preparation_0">
                <label>
                    <input type="checkbox" onchange="updateItem('preparation_0')">
                    <span>√âquipement DiagPV complet (testeurs, drones, EPI)</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>

            <div class="check-item " id="item_preparation_1">
                <label>
                    <input type="checkbox" onchange="updateItem('preparation_1')">
                    <span>Documentation centrale consult√©e (sch√©mas, DOE)</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>

            <div class="check-item " id="item_preparation_2">
                <label>
                    <input type="checkbox" onchange="updateItem('preparation_2')">
                    <span>Contact exploitant confirm√©</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>

            <div class="check-item " id="item_preparation_3">
                <label>
                    <input type="checkbox" onchange="updateItem('preparation_3')">
                    <span>Conditions m√©t√©o favorables (irradiation >500 W/m¬≤)</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>
        </div>

        <div class="section">
            <div class="section-header">‚òÄÔ∏è 2. MODULES PHOTOVOLTA√èQUES</div>

            <div class="check-item " id="item_modules_0">
                <label>
                    <input type="checkbox" onchange="updateItem('modules_0')">
                    <span>√âtat g√©n√©ral modules (propret√©, int√©grit√©)</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>

            <div class="check-item " id="item_modules_1">
                <label>
                    <input type="checkbox" onchange="updateItem('modules_1')">
                    <span>Absence fissures visibles</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>

            <div class="check-item " id="item_modules_2">
                <label>
                    <input type="checkbox" onchange="updateItem('modules_2')">
                    <span>Bo√Ætes jonction modules OK</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>

            <div class="check-item " id="item_modules_3">
                <label>
                    <input type="checkbox" onchange="updateItem('modules_3')">
                    <span>C√¢blage modules conforme</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>

            <div class="check-item " id="item_modules_4">
                <label>
                    <input type="checkbox" onchange="updateItem('modules_4')">
                    <span>Photos modules (min 10 photos d√©tails + d√©fauts)</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>
        </div>

        <div class="section">
            <div class="section-header">‚ö° 3. ONDULEURS & PROTECTION √âLECTRIQUE</div>

            <div class="check-item " id="item_onduleurs_0">
                <label>
                    <input type="checkbox" onchange="updateItem('onduleurs_0')">
                    <span>Onduleurs op√©rationnels (voyants verts)</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>

            <div class="check-item " id="item_onduleurs_1">
                <label>
                    <input type="checkbox" onchange="updateItem('onduleurs_1')">
                    <span>Affichage production instantan√©e coh√©rente</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>

            <div class="check-item " id="item_onduleurs_2">
                <label>
                    <input type="checkbox" onchange="updateItem('onduleurs_2')">
                    <span>Absence alarmes/codes erreur</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>

            <div class="check-item " id="item_onduleurs_3">
                <label>
                    <input type="checkbox" onchange="updateItem('onduleurs_3')">
                    <span>Protection AC/DC conformes</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>

            <div class="check-item " id="item_onduleurs_4">
                <label>
                    <input type="checkbox" onchange="updateItem('onduleurs_4')">
                    <span>Mesures tension/courant strings</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>

            <div class="check-item " id="item_onduleurs_5">
                <label>
                    <input type="checkbox" onchange="updateItem('onduleurs_5')">
                    <span>Photos onduleurs + tableau √©lectrique (min 5)</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>
        </div>

        <div class="section">
            <div class="section-header">üå°Ô∏è 4. THERMOGRAPHIE IR (si applicable)</div>

            <div class="check-item " id="item_thermographie_0">
                <label>
                    <input type="checkbox" onchange="updateItem('thermographie_0')">
                    <span>Conditions thermographie valid√©es (>500 W/m¬≤, vent <20 km/h)</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>

            <div class="check-item " id="item_thermographie_1">
                <label>
                    <input type="checkbox" onchange="updateItem('thermographie_1')">
                    <span>Vol drone thermographie effectu√©</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>

            <div class="check-item " id="item_thermographie_2">
                <label>
                    <input type="checkbox" onchange="updateItem('thermographie_2')">
                    <span>Couverture compl√®te champ PV</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>

            <div class="check-item " id="item_thermographie_3">
                <label>
                    <input type="checkbox" onchange="updateItem('thermographie_3')">
                    <span>Hotspots d√©tect√©s et localis√©s</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>

            <div class="check-item " id="item_thermographie_4">
                <label>
                    <input type="checkbox" onchange="updateItem('thermographie_4')">
                    <span>Images thermiques sauvegard√©es</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>
        </div>

        <div class="section">
            <div class="section-header">‚úÖ 6. POST-INTERVENTION</div>

            <div class="check-item " id="item_post_0">
                <label>
                    <input type="checkbox" onchange="updateItem('post_0')">
                    <span>Toutes photos nomenclature prises (GEN/ELEC/MP/BP/DOC)</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>

            <div class="check-item " id="item_post_1">
                <label>
                    <input type="checkbox" onchange="updateItem('post_1')">
                    <span>Observations terrain compl√©t√©es</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>

            <div class="check-item " id="item_post_2">
                <label>
                    <input type="checkbox" onchange="updateItem('post_2')">
                    <span>Mesures √©lectriques enregistr√©es</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>

            <div class="check-item " id="item_post_3">
                <label>
                    <input type="checkbox" onchange="updateItem('post_3')">
                    <span>Installation remise en √©tat</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>

            <div class="check-item " id="item_post_4">
                <label>
                    <input type="checkbox" onchange="updateItem('post_4')">
                    <span>Site nettoy√© et s√©curis√©</span>
                </label>
                <textarea placeholder="Observations..." onchange="saveLocal()"></textarea>
            </div>
        </div>

        <div class="section">
            <div class="section-header">üì∏ PHOTOS TERRAIN</div>
            
            <div class="alert alert-warning">
                <strong>‚ö†Ô∏è NOMENCLATURE PHOTOS OBLIGATOIRE :</strong><br>
                ‚Ä¢ <strong>GEN</strong> : Vues g√©n√©rales (min 5)<br>
                ‚Ä¢ <strong>ELEC</strong> : Onduleurs, c√¢bles, protections (min 5)<br>
                ‚Ä¢ <strong>MP</strong> : Modules d√©tails (min 10)<br>
                ‚Ä¢ <strong>BP</strong> : Bo√Ætes protection (min 2)<br>
                
                ‚Ä¢ <strong>DOC</strong> : Documents, sch√©mas (min 1)<br>
                <strong>TOTAL MINIMUM : 25 photos</strong>
            </div>
            
            <div class="photo-zone">
                <input type="file" id="photoInput" accept="image/*" multiple>
                <button class="btn-upload" onclick="document.getElementById('photoInput').click()">
                    üì∑ AJOUTER PHOTOS
                </button>
                <p style="margin-top: 15px; color: #666;">S√©lectionner plusieurs photos √† la fois</p>
            </div>
            
            <div class="photo-stats" id="photoStats">
                üìä Photos: <span id="nbPhotos">0</span> | Taille: <span id="taillePhotos">0 MB</span>
            </div>
            
            <div class="photo-preview" id="photoPreview"></div>
        </div>
        
        <div class="section">
            <div class="alert alert-info">
                <strong>üíæ SAUVEGARDE AUTOMATIQUE :</strong> Les donn√©es sont sauvegard√©es localement toutes les 10 secondes.
            </div>
            
            <button class="btn-export" onclick="exporterJSON()">
                üì• EXPORTER CHECKLIST + PHOTOS (JSON)
            </button>
        </div>
        
        <div class="footer">
            <p><strong>Diagnostic Photovolta√Øque</strong> | 3 rue d'Apollo, 31240 L'Union</p>
            <p>‚òéÔ∏è 05.81.10.16.59 | üìß contact@diagpv.fr | üåê www.diagnosticphotovoltaique.fr</p>
            <p style="margin-top: 10px;">RCS Toulouse 792 972 309 | Mission GIRASOLE 2025</p>
        </div>
    </div>
    
    <script>
        const CENTRALE_ID = '31971';
        const CENTRALE_NOM = 'Antunez - SCI ANAUJA';
        let photosBase64 = [];
        let totalSize = 0;
        
        // Date du jour par d√©faut
        document.getElementById('date').value = new Date().toISOString().split('T')[0];
        
        // Update item √©tat
        function updateItem(itemId) {
            const item = document.getElementById('item_' + itemId);
            const checkbox = item.querySelector('input[type="checkbox"]');
            if (checkbox.checked) {
                item.classList.add('checked');
            } else {
                item.classList.remove('checked');
            }
            saveLocal();
        }
        
        // Gestion photos
        document.getElementById('photoInput').addEventListener('change', function(e) {
            const files = e.target.files;
            for (let file of files) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const base64Data = event.target.result;
                    totalSize += base64Data.length;
                    
                    photosBase64.push({
                        nom: file.name,
                        taille: file.size,
                        type: file.type,
                        data: base64Data,
                        date: new Date().toISOString()
                    });
                    
                    // Pr√©visualisation
                    const img = document.createElement('img');
                    img.src = base64Data;
                    img.onclick = function() { window.open(base64Data); };
                    document.getElementById('photoPreview').appendChild(img);
                    
                    updatePhotoStats();
                    saveLocal();
                };
                reader.readAsDataURL(file);
            }
        });
        
        function updatePhotoStats() {
            document.getElementById('nbPhotos').textContent = photosBase64.length;
            document.getElementById('taillePhotos').textContent = (totalSize / (1024 * 1024)).toFixed(2);
        }
        
        // Export JSON
        function exporterJSON() {
            const auditeur = document.getElementById('auditeur').value;
            const date = document.getElementById('date').value;
            const meteo = document.getElementById('meteo').value;
            const temperature = document.getElementById('temperature').value;
            
            if (!auditeur || !date || !meteo) {
                alert('‚ö†Ô∏è Veuillez remplir les champs obligatoires: Nom, Date, M√©t√©o');
                return;
            }
            
            const data = {
                centrale_id: CENTRALE_ID,
                centrale_nom: CENTRALE_NOM,
                auditeur: auditeur,
                date_audit: date,
                meteo: meteo,
                temperature: temperature,
                horodatage: new Date().toISOString(),
                audit_toiture: false,
                points_controle: [],
                photos: photosBase64,
                nb_photos: photosBase64.length,
                taille_totale_mb: (totalSize / (1024 * 1024)).toFixed(2)
            };
            
            // R√©cup√©ration points contr√¥le
            document.querySelectorAll('.check-item').forEach((item, index) => {
                const checkbox = item.querySelector('input[type="checkbox"]');
                const textarea = item.querySelector('textarea');
                const label = item.querySelector('label span');
                
                data.points_controle.push({
                    id: index,
                    titre: label.textContent.trim(),
                    checked: checkbox.checked,
                    observations: textarea.value
                });
            });
            
            // T√©l√©chargement
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `audit_${CENTRALE_ID}_${date}_${Date.now()}.json`;
            a.click();
            
            alert(`‚úÖ Export r√©ussi !\n\n` +
                  `Centrale: ${CENTRALE_ID} - ${CENTRALE_NOM}\n` +
                  `Photos: ${photosBase64.length}\n` +
                  `Taille: ${(totalSize / (1024 * 1024)).toFixed(2)} MB\n\n` +
                  `üìß Envoyer ce fichier JSON √† DiagPV`);
        }
        
        // Auto-save LocalStorage
        function saveLocal() {
            const data = {
                centrale_id: CENTRALE_ID,
                auditeur: document.getElementById('auditeur').value,
                date: document.getElementById('date').value,
                meteo: document.getElementById('meteo').value,
                temperature: document.getElementById('temperature').value,
                checkboxes: [],
                textareas: [],
                photos_count: photosBase64.length,
                last_save: new Date().toISOString()
            };
            
            document.querySelectorAll('.check-item input[type="checkbox"]').forEach(cb => {
                data.checkboxes.push(cb.checked);
            });
            
            document.querySelectorAll('.check-item textarea').forEach(ta => {
                data.textareas.push(ta.value);
            });
            
            localStorage.setItem('checklist_' + CENTRALE_ID, JSON.stringify(data));
        }
        
        // Chargement auto-save
        function loadLocal() {
            const saved = localStorage.getItem('checklist_' + CENTRALE_ID);
            if (saved) {
                const data = JSON.parse(saved);
                document.getElementById('auditeur').value = data.auditeur || '';
                document.getElementById('date').value = data.date || '';
                document.getElementById('meteo').value = data.meteo || '';
                document.getElementById('temperature').value = data.temperature || '';
                
                const checkboxes = document.querySelectorAll('.check-item input[type="checkbox"]');
                const textareas = document.querySelectorAll('.check-item textarea');
                
                data.checkboxes.forEach((checked, i) => {
                    if (checkboxes[i]) {
                        checkboxes[i].checked = checked;
                        if (checked) {
                            checkboxes[i].closest('.check-item').classList.add('checked');
                        }
                    }
                });
                
                data.textareas.forEach((value, i) => {
                    if (textareas[i]) {
                        textareas[i].value = value;
                    }
                });
            }
        }
        
        // Auto-save p√©riodique
        setInterval(saveLocal, 10000);
        
        // Init
        window.addEventListener('DOMContentLoaded', loadLocal);
    </script>
</body>
</html>