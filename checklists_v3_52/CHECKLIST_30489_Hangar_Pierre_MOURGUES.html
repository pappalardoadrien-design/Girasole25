<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checklist Audit - Hangar Pierre MOURGUES</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
            line-height: 1.6;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }
        .header h1 { font-size: 24px; margin-bottom: 8px; }
        .centrale-info {
            background: rgba(255,255,255,0.15);
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            text-align: left;
            font-size: 13px;
        }
        .centrale-info p { margin: 4px 0; }
        
        .section {
            padding: 20px;
            border-bottom: 2px solid #e9ecef;
        }
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
        }
        
        .question {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 8px;
            border-left: 4px solid #2ecc71;
        }
        .question label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .question input[type="text"],
        .question textarea,
        .question select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        .question textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        /* PHOTOS SECTION */
        .photo-section {
            background: #fff3cd;
            border: 3px dashed #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }
        .photo-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        .photo-category {
            font-size: 18px;
            font-weight: bold;
            color: #856404;
        }
        .photo-count {
            background: #28a745;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        .photo-guide {
            background: white;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 12px;
            font-size: 13px;
            color: #666;
        }
        .photo-guide strong {
            color: #856404;
            display: block;
            margin-bottom: 5px;
        }
        .btn-photo {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #28a745 0%, #20803a 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-photo:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40,167,69,0.3);
        }
        .btn-photo:active {
            transform: translateY(0);
        }
        .photo-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .photo-preview img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid #ddd;
            transition: all 0.3s;
        }
        .photo-preview img:hover {
            transform: scale(1.05);
            border-color: #28a745;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 14px;
        }
        .alert-info {
            background: #d1ecf1;
            border-left: 4px solid #0c5460;
            color: #0c5460;
        }
        .alert-success {
            background: #d4edda;
            border-left: 4px solid #155724;
            color: #155724;
        }
        
        .btn-export {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 20px 0;
        }
        .btn-export:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,123,255,0.3);
        }
        
        .footer {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 12px;
        }
        .footer p { margin: 5px 0; }
        
        input[type="file"] {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>üìã CHECKLIST AUDIT PHOTOVOLTA√èQUE</h1>
            <p>Diagnostic Photovolta√Øque - Mission GIRASOLE 2025</p>
            <div class="centrale-info">
                <p><strong>üè≠ Centrale :</strong> 30489 - Hangar Pierre MOURGUES</p>
                <p><strong>‚ö° Puissance :</strong> 222.5 kWc</p>
                <p><strong>üìç Adresse :</strong> Mondounet - Fargues, 46800 Porte-du-Quercy, France</p>
                <p><strong>üè∑Ô∏è Type :</strong> SOL</p>
            </div>
        </div>

        <!-- SECTION 1 : INFORMATIONS G√âN√âRALES -->
        <div class="section">
            <div class="section-header">
                <span>üìÖ 1. INFORMATIONS G√âN√âRALES</span>
            </div>
            
            <div class="question">
                <label>Date intervention</label>
                <input type="date" id="date_intervention">
            </div>
            
            <div class="question">
                <label>Heure d√©but</label>
                <input type="time" id="heure_debut">
            </div>
            
            <div class="question">
                <label>Technicien (Nom + Pr√©nom)</label>
                <input type="text" id="technicien" placeholder="Ex: Dupont Jean">
            </div>
            
            <div class="question">
                <label>M√©t√©o</label>
                <select id="meteo">
                    <option value="">-- S√©lectionner --</option>
                    <option value="Ensoleill√©">‚òÄÔ∏è Ensoleill√©</option>
                    <option value="Nuageux">‚òÅÔ∏è Nuageux</option>
                    <option value="Pluvieux">üåßÔ∏è Pluvieux</option>
                    <option value="Venteux">üí® Venteux</option>
                </select>
            </div>
            
            <div class="question">
                <label>Temp√©rature (¬∞C)</label>
                <input type="number" id="temperature" placeholder="Ex: 25">
            </div>
        </div>

        <!-- SECTION 2 : CONFORMIT√â √âLECTRIQUE + PHOTOS ELEC -->
        <div class="section">
            <div class="section-header">
                <span>‚ö° 2. CONFORMIT√â √âLECTRIQUE</span>
            </div>
            
            <div class="question">
                <label>√âtat AGCP (Appareil G√©n√©ral de Coupure et Protection)</label>
                <select id="agcp">
                    <option value="">-- S√©lectionner --</option>
                    <option value="Conforme">‚úÖ Conforme</option>
                    <option value="Non conforme">‚ùå Non conforme</option>
                    <option value="√Ä v√©rifier">‚ö†Ô∏è √Ä v√©rifier</option>
                </select>
            </div>
            
            <div class="question">
                <label>Onduleurs fonctionnels</label>
                <select id="onduleurs">
                    <option value="">-- S√©lectionner --</option>
                    <option value="Oui">‚úÖ Oui - tous fonctionnels</option>
                    <option value="Non">‚ùå Non - d√©faillances d√©tect√©es</option>
                    <option value="Partiel">‚ö†Ô∏è Partiel - certains d√©fauts</option>
                </select>
            </div>
            
            <div class="question">
                <label>C√¢blage et protections</label>
                <textarea id="cablage" placeholder="D√©crire √©tat g√©n√©ral, d√©fauts d√©tect√©s, points d'attention..."></textarea>
            </div>
            
            <!-- PHOTOS √âLECTRIQUE -->
            <div class="photo-section">
                <div class="photo-header">
                    <span class="photo-category">üì∏ PHOTOS √âLECTRIQUE (ELEC)</span>
                    <span class="photo-count" id="count_ELEC">0 photos</span>
                </div>
                <div class="photo-guide">
                    <strong>üìã √Ä photographier (minimum 5 photos) :</strong>
                    ‚Ä¢ AGCP complet (vue d'ensemble + d√©tail)<br>
                    ‚Ä¢ Chaque onduleur (fa√ßade + √©cran √©tat)<br>
                    ‚Ä¢ Tableau √©lectrique AC<br>
                    ‚Ä¢ C√¢blage g√©n√©ral DC/AC<br>
                    ‚Ä¢ Dispositifs protection (parafoudres, sectionneurs)
                </div>
                <input type="file" id="photo_ELEC" accept="image/*" multiple capture="environment">
                <button class="btn-photo" onclick="document.getElementById('photo_ELEC').click()">
                    üì∑ PRENDRE/AJOUTER PHOTOS √âLECTRIQUE
                </button>
                <div class="photo-preview" id="preview_ELEC"></div>
            </div>
        </div>

        <!-- SECTION 3 : MODULES PHOTOVOLTA√èQUES + PHOTOS MP -->
        <div class="section">
            <div class="section-header">
                <span>‚òÄÔ∏è 3. MODULES PHOTOVOLTA√èQUES</span>
            </div>
            
            <div class="question">
                <label>√âtat visuel g√©n√©ral modules</label>
                <select id="etat_modules">
                    <option value="">-- S√©lectionner --</option>
                    <option value="Bon">‚úÖ Bon √©tat</option>
                    <option value="Moyen">‚ö†Ô∏è √âtat moyen - d√©fauts mineurs</option>
                    <option value="Mauvais">‚ùå Mauvais √©tat - d√©fauts majeurs</option>
                </select>
            </div>
            
            <div class="question">
                <label>D√©fauts d√©tect√©s (salissures, fissures, d√©coloration...)</label>
                <textarea id="defauts_modules" placeholder="Lister tous d√©fauts observ√©s avec localisation..."></textarea>
            </div>
            
            <div class="question">
                <label>Points chauds d√©tect√©s (thermographie)</label>
                <select id="points_chauds">
                    <option value="">-- S√©lectionner --</option>
                    <option value="Non">‚úÖ Non - pas de points chauds</option>
                    <option value="Oui">‚ùå Oui - points chauds d√©tect√©s</option>
                </select>
            </div>
            
            <!-- PHOTOS MODULES -->
            <div class="photo-section">
                <div class="photo-header">
                    <span class="photo-category">üì∏ PHOTOS MODULES (MP)</span>
                    <span class="photo-count" id="count_MP">0 photos</span>
                </div>
                <div class="photo-guide">
                    <strong>üìã √Ä photographier (minimum 10 photos) :</strong>
                    ‚Ä¢ Vue d'ensemble installation (plusieurs angles)<br>
                    ‚Ä¢ Modules avec d√©fauts (fissures, taches, d√©coloration)<br>
                    ‚Ä¢ Points chauds thermographie (si d√©tect√©s)<br>
                    ‚Ä¢ Connecteurs MC4<br>
                    ‚Ä¢ Salissures importantes<br>
                    ‚Ä¢ Plaques signal√©tiques modules (marque, puissance)
                </div>
                <input type="file" id="photo_MP" accept="image/*" multiple capture="environment">
                <button class="btn-photo" onclick="document.getElementById('photo_MP').click()">
                    üì∑ PRENDRE/AJOUTER PHOTOS MODULES
                </button>
                <div class="photo-preview" id="preview_MP"></div>
            </div>
        </div>

        <!-- SECTION 4 : STRUCTURE + PHOTOS TOIT -->
        <div class="section">
            <div class="section-header">
                <span>üèóÔ∏è 4. STRUCTURE & SUPPORT</span>
            </div>
            
            <div class="question">
                <label>Type installation</label>
                <select id="type_install">
                    <option value="Sol" selected>üåæ Installation au sol</option>
                    <option value="Toiture" >üè† Installation toiture</option>
                </select>
            </div>
            
            <div class="question">
                <label>√âtat structure porteuse</label>
                <select id="structure">
                    <option value="">-- S√©lectionner --</option>
                    <option value="Bon">‚úÖ Bon √©tat</option>
                    <option value="Moyen">‚ö†Ô∏è √âtat moyen - attention requise</option>
                    <option value="Mauvais">‚ùå Mauvais √©tat - intervention n√©cessaire</option>
                </select>
            </div>
            
            <div class="question">
                <label>Fixations et boulonnerie</label>
                <textarea id="fixations" placeholder="√âtat boulons, rails, corrosion √©ventuelle..."></textarea>
            </div>
            
            <!-- PHOTOS STRUCTURE -->
            <div class="photo-section">
                <div class="photo-header">
                    <span class="photo-category">üì∏ PHOTOS STRUCTURE (TOIT)</span>
                    <span class="photo-count" id="count_TOIT">0 photos</span>
                </div>
                <div class="photo-guide">
                    <strong>üìã √Ä photographier (minimum 5 photos) :</strong>
                    ‚Ä¢ Vue d'ensemble structure support<br>
                    ‚Ä¢ Fondations ou ancrages toiture<br>
                    ‚Ä¢ Rails et fixations modules<br>
                    ‚Ä¢ Boulonnerie (√©tat, corrosion)<br>
                    ‚Ä¢ D√©fauts structure (d√©formations, fissures)
                </div>
                <input type="file" id="photo_TOIT" accept="image/*" multiple capture="environment">
                <button class="btn-photo" onclick="document.getElementById('photo_TOIT').click()">
                    üì∑ PRENDRE/AJOUTER PHOTOS STRUCTURE
                </button>
                <div class="photo-preview" id="preview_TOIT"></div>
            </div>
        </div>

        <!-- SECTION 5 : BO√éTES PROTECTION + PHOTOS BP -->
        <div class="section">
            <div class="section-header">
                <span>üì¶ 5. BO√éTES DE PROTECTION</span>
            </div>
            
            <div class="question">
                <label>Bo√Ætes de jonction accessibles</label>
                <select id="boites_access">
                    <option value="">-- S√©lectionner --</option>
                    <option value="Oui">‚úÖ Oui - toutes accessibles</option>
                    <option value="Non">‚ùå Non - certaines inaccessibles</option>
                </select>
            </div>
            
            <div class="question">
                <label>√âtat bo√Ætes (√©tanch√©it√©, c√¢blage)</label>
                <textarea id="etat_boites" placeholder="√âtanch√©it√©, serrage c√¢bles, propret√©..."></textarea>
            </div>
            
            <!-- PHOTOS BO√éTES -->
            <div class="photo-section">
                <div class="photo-header">
                    <span class="photo-category">üì∏ PHOTOS BO√éTES (BP)</span>
                    <span class="photo-count" id="count_BP">0 photos</span>
                </div>
                <div class="photo-guide">
                    <strong>üìã √Ä photographier (minimum 2 photos) :</strong>
                    ‚Ä¢ Chaque bo√Æte de jonction (ext√©rieur)<br>
                    ‚Ä¢ Int√©rieur bo√Ætes (c√¢blage, protections)<br>
                    ‚Ä¢ D√©fauts d√©tect√©s (√©tanch√©it√©, corrosion)
                </div>
                <input type="file" id="photo_BP" accept="image/*" multiple capture="environment">
                <button class="btn-photo" onclick="document.getElementById('photo_BP').click()">
                    üì∑ PRENDRE/AJOUTER PHOTOS BO√éTES
                </button>
                <div class="photo-preview" id="preview_BP"></div>
            </div>
        </div>

        <!-- SECTION 6 : G√âN√âRAL + PHOTOS GEN -->
        <div class="section">
            <div class="section-header">
                <span>üåç 6. VUE G√âN√âRALE & ENVIRONNEMENT</span>
            </div>
            
            <div class="question">
                <label>Acc√®s site</label>
                <select id="acces">
                    <option value="">-- S√©lectionner --</option>
                    <option value="Facile">‚úÖ Facile</option>
                    <option value="Moyen">‚ö†Ô∏è Moyen</option>
                    <option value="Difficile">‚ùå Difficile</option>
                </select>
            </div>
            
            <div class="question">
                <label>V√©g√©tation / Ombrage</label>
                <textarea id="vegetation" placeholder="Pr√©sence v√©g√©tation, ombres port√©es, n√©cessit√© d√©broussaillage..."></textarea>
            </div>
            
            <div class="question">
                <label>Observations g√©n√©rales</label>
                <textarea id="observations" placeholder="Tout √©l√©ment remarquable, anomalie, point d'attention..."></textarea>
            </div>
            
            <!-- PHOTOS G√âN√âRALES -->
            <div class="photo-section">
                <div class="photo-header">
                    <span class="photo-category">üì∏ PHOTOS G√âN√âRALES (GEN)</span>
                    <span class="photo-count" id="count_GEN">0 photos</span>
                </div>
                <div class="photo-guide">
                    <strong>üìã √Ä photographier (minimum 5 photos) :</strong>
                    ‚Ä¢ Vue a√©rienne ou panoramique installation compl√®te<br>
                    ‚Ä¢ Acc√®s site (entr√©e, parking)<br>
                    ‚Ä¢ Environnement imm√©diat<br>
                    ‚Ä¢ V√©g√©tation si impactante<br>
                    ‚Ä¢ Signal√©tique site
                </div>
                <input type="file" id="photo_GEN" accept="image/*" multiple capture="environment">
                <button class="btn-photo" onclick="document.getElementById('photo_GEN').click()">
                    üì∑ PRENDRE/AJOUTER PHOTOS G√âN√âRALES
                </button>
                <div class="photo-preview" id="preview_GEN"></div>
            </div>
        </div>

        <!-- SECTION 7 : DOCUMENTS + PHOTOS DOC -->
        <div class="section">
            <div class="section-header">
                <span>üìÑ 7. DOCUMENTS & SCH√âMAS</span>
            </div>
            
            <div class="question">
                <label>Documents accessibles sur site</label>
                <select id="documents">
                    <option value="">-- S√©lectionner --</option>
                    <option value="Oui">‚úÖ Oui - documents pr√©sents</option>
                    <option value="Non">‚ùå Non - documents absents</option>
                    <option value="Partiel">‚ö†Ô∏è Partiel - certains manquants</option>
                </select>
            </div>
            
            <div class="question">
                <label>Liste documents consult√©s</label>
                <textarea id="liste_docs" placeholder="Sch√©ma unifilaire, plans, PV r√©ception, attestations..."></textarea>
            </div>
            
            <!-- PHOTOS DOCUMENTS -->
            <div class="photo-section">
                <div class="photo-header">
                    <span class="photo-category">üì∏ PHOTOS DOCUMENTS (DOC)</span>
                    <span class="photo-count" id="count_DOC">0 photos</span>
                </div>
                <div class="photo-guide">
                    <strong>üìã √Ä photographier (minimum 1 photo) :</strong>
                    ‚Ä¢ Sch√©ma √©lectrique unifilaire<br>
                    ‚Ä¢ Plans installation<br>
                    ‚Ä¢ Plaques signal√©tiques (onduleurs, modules)<br>
                    ‚Ä¢ PV r√©ception ou autocontr√¥les<br>
                    ‚Ä¢ Attestations conformit√©
                </div>
                <input type="file" id="photo_DOC" accept="image/*" multiple capture="environment">
                <button class="btn-photo" onclick="document.getElementById('photo_DOC').click()">
                    üì∑ PRENDRE/AJOUTER PHOTOS DOCUMENTS
                </button>
                <div class="photo-preview" id="preview_DOC"></div>
            </div>
        </div>

        <!-- R√âCAPITULATIF PHOTOS -->
        <div class="section">
            <div class="alert alert-success">
                <strong>üìä R√âCAPITULATIF PHOTOS</strong><br><br>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                    <div>
                        <strong>GEN (G√©n√©ral):</strong> <span id="total_GEN">0</span> / 5 min<br>
                        <strong>ELEC (√âlectrique):</strong> <span id="total_ELEC">0</span> / 5 min<br>
                        <strong>MP (Modules):</strong> <span id="total_MP">0</span> / 10 min
                    </div>
                    <div>
                        <strong>BP (Bo√Ætes):</strong> <span id="total_BP">0</span> / 2 min<br>
                        <strong>TOIT (Structure):</strong> <span id="total_TOIT">0</span> / 5 min<br>
                        <strong>DOC (Documents):</strong> <span id="total_DOC">0</span> / 1 min
                    </div>
                </div>
                <hr style="margin: 15px 0; border: none; border-top: 2px solid #155724;">
                <strong style="font-size: 16px;">TOTAL: <span id="total_ALL">0</span> photos / 28 minimum requis</strong>
            </div>
        </div>

        <!-- EXPORT -->
        <div class="section">
            <div class="alert alert-info">
                <strong>üíæ SAUVEGARDE AUTOMATIQUE :</strong><br>
                Vos donn√©es sont sauvegard√©es localement toutes les 10 secondes.<br>
                Vous pouvez fermer et rouvrir cette page sans perdre vos donn√©es.
            </div>
            
            <button class="btn-export" onclick="exporterJSON()">
                üì• EXPORTER CHECKLIST + PHOTOS (JSON)
            </button>
            
            <div class="alert alert-info">
                <strong>üì§ APR√àS EXPORT :</strong><br>
                1. R√©cup√®re le fichier <strong>30489_terrain.json</strong><br>
                2. Envoie-le par email √† <strong>contact@diagpv.fr</strong><br>
                3. Ou copie-le dans <strong>/exports_json/</strong> pour g√©n√©ration automatique rapport
            </div>
        </div>

        <!-- FOOTER -->
        <div class="footer">
            <p><strong>Diagnostic Photovolta√Øque - Groupe Watt&co</strong></p>
            <p>3 rue d'Apollo, 31240 L'UNION</p>
            <p>‚òéÔ∏è 05.81.10.16.59 | üìß contact@diagpv.fr | üåê www.diagnosticphotovoltaique.fr</p>
            <p style="margin-top: 10px;">RCS Toulouse 792 972 309 | Mission GIRASOLE 2025</p>
        </div>
    </div>

    <script>
        const CENTRALE_ID = '30489';
        const CENTRALE_NOM = 'Hangar Pierre MOURGUES';
        const STORAGE_KEY = 'checklist_' + CENTRALE_ID;
        
        const photos = {
            GEN: [],
            ELEC: [],
            MP: [],
            BP: [],
            TOIT: [],
            DOC: []
        };
        
        document.getElementById('date_intervention').value = new Date().toISOString().split('T')[0];
        
        ['GEN', 'ELEC', 'MP', 'BP', 'TOIT', 'DOC'].forEach(cat => {
            document.getElementById('photo_' + cat).addEventListener('change', function(e) {
                const files = e.target.files;
                let processed = 0;
                
                for (let file of files) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        photos[cat].push({
                            categorie: cat,
                            nom: file.name,
                            taille: file.size,
                            type: file.type,
                            data: event.target.result,
                            date: new Date().toISOString()
                        });
                        
                        const img = document.createElement('img');
                        img.src = event.target.result;
                        img.onclick = function() { window.open(event.target.result); };
                        document.getElementById('preview_' + cat).appendChild(img);
                        
                        processed++;
                        if (processed === files.length) {
                            updatePhotoStats();
                            saveLocal();
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });
        });
        
        function updatePhotoStats() {
            let total = 0;
            ['GEN', 'ELEC', 'MP', 'BP', 'TOIT', 'DOC'].forEach(cat => {
                const count = photos[cat].length;
                document.getElementById('count_' + cat).textContent = count + ' photo' + (count > 1 ? 's' : '');
                document.getElementById('total_' + cat).textContent = count;
                total += count;
            });
            document.getElementById('total_ALL').textContent = total;
        }
        
        function exporterJSON() {
            const data = {
                centrale: {
                    id: CENTRALE_ID,
                    nom: CENTRALE_NOM,
                    puissance_kwc: 222.5,
                    adresse: 'Mondounet - Fargues, 46800 Porte-du-Quercy, France',
                    type: 'SOL'
                },
                audit: {
                    date_intervention: document.getElementById('date_intervention').value,
                    heure_debut: document.getElementById('heure_debut').value,
                    technicien: document.getElementById('technicien').value,
                    meteo: document.getElementById('meteo').value,
                    temperature: document.getElementById('temperature').value
                },
                conformite_electrique: {
                    agcp: document.getElementById('agcp').value,
                    onduleurs: document.getElementById('onduleurs').value,
                    cablage: document.getElementById('cablage').value
                },
                modules: {
                    etat_general: document.getElementById('etat_modules').value,
                    defauts: document.getElementById('defauts_modules').value,
                    points_chauds: document.getElementById('points_chauds').value
                },
                structure: {
                    type: document.getElementById('type_install').value,
                    etat: document.getElementById('structure').value,
                    fixations: document.getElementById('fixations').value
                },
                boites_protection: {
                    accessibles: document.getElementById('boites_access').value,
                    etat: document.getElementById('etat_boites').value
                },
                general: {
                    acces: document.getElementById('acces').value,
                    vegetation: document.getElementById('vegetation').value,
                    observations: document.getElementById('observations').value
                },
                documents: {
                    accessibles: document.getElementById('documents').value,
                    liste: document.getElementById('liste_docs').value
                },
                photos: photos,
                stats_photos: {
                    total: Object.values(photos).reduce((sum, arr) => sum + arr.length, 0),
                    par_categorie: {
                        GEN: photos.GEN.length,
                        ELEC: photos.ELEC.length,
                        MP: photos.MP.length,
                        BP: photos.BP.length,
                        TOIT: photos.TOIT.length,
                        DOC: photos.DOC.length
                    }
                },
                metadata: {
                    version: '3.0',
                    export_date: new Date().toISOString(),
                    device: navigator.userAgent
                }
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = CENTRALE_ID + '_terrain.json';
            a.click();
            
            alert('‚úÖ Export r√©ussi !\n\n' +
                  'Fichier: ' + CENTRALE_ID + '_terrain.json\n' +
                  'Photos: ' + data.stats_photos.total + ' incluses\n\n' +
                  'Envoie ce fichier √† contact@diagpv.fr');
        }
        
        function saveLocal() {
            const data = {
                date_intervention: document.getElementById('date_intervention').value,
                heure_debut: document.getElementById('heure_debut').value,
                technicien: document.getElementById('technicien').value,
                meteo: document.getElementById('meteo').value,
                temperature: document.getElementById('temperature').value,
                agcp: document.getElementById('agcp').value,
                onduleurs: document.getElementById('onduleurs').value,
                cablage: document.getElementById('cablage').value,
                etat_modules: document.getElementById('etat_modules').value,
                defauts_modules: document.getElementById('defauts_modules').value,
                points_chauds: document.getElementById('points_chauds').value,
                type_install: document.getElementById('type_install').value,
                structure: document.getElementById('structure').value,
                fixations: document.getElementById('fixations').value,
                boites_access: document.getElementById('boites_access').value,
                etat_boites: document.getElementById('etat_boites').value,
                acces: document.getElementById('acces').value,
                vegetation: document.getElementById('vegetation').value,
                observations: document.getElementById('observations').value,
                documents: document.getElementById('documents').value,
                liste_docs: document.getElementById('liste_docs').value,
                photos: photos
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }
        
        function loadLocal() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const data = JSON.parse(saved);
                Object.keys(data).forEach(key => {
                    if (key === 'photos') {
                        Object.keys(data.photos).forEach(cat => {
                            photos[cat] = data.photos[cat];
                            data.photos[cat].forEach(photo => {
                                const img = document.createElement('img');
                                img.src = photo.data;
                                img.onclick = function() { window.open(photo.data); };
                                document.getElementById('preview_' + cat).appendChild(img);
                            });
                        });
                        updatePhotoStats();
                    } else {
                        const elem = document.getElementById(key);
                        if (elem) elem.value = data[key];
                    }
                });
            }
        }
        
        setInterval(saveLocal, 10000);
        loadLocal();
        
        document.querySelectorAll('input, select, textarea').forEach(elem => {
            elem.addEventListener('change', saveLocal);
        });
        
        console.log('üìã Checklist GIRASOLE V3 - Centrale 30489');
    </script>
</body>
</html>