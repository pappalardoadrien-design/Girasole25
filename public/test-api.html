<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Suivi Missions</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">üîç Test API Suivi Missions</h1>
        
        <button onclick="testAPI()" class="bg-blue-600 text-white px-6 py-3 rounded-lg mb-6">
            üîÑ Charger API /api/suivi-missions
        </button>
        
        <div id="result" class="bg-white rounded-lg shadow p-6">
            <p class="text-gray-500">Cliquez sur le bouton pour tester l'API...</p>
        </div>
    </div>
    
    <script>
        async function testAPI() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p class="text-blue-600">‚è≥ Chargement...</p>';
            
            try {
                const response = await fetch('/api/suivi-missions');
                const data = await response.json();
                
                if (!data.success || !data.data) {
                    resultDiv.innerHTML = '<p class="text-red-600">‚ùå Erreur API</p>';
                    return;
                }
                
                // Filtrer missions 7, 12, 20, 24, 33, 45, 46
                const missionsCritiques = data.data.filter(m => 
                    [7, 12, 20, 24, 33, 45, 46].includes(m.mission_id)
                );
                
                resultDiv.innerHTML = `
                    <h2 class="text-xl font-bold mb-4">‚úÖ API fonctionne - ${missionsCritiques.length} missions critiques :</h2>
                    <div class="space-y-4">
                        ${missionsCritiques.map(m => {
                            const progression = m.nb_points_total > 0 
                                ? Math.round((m.nb_points_completes / m.nb_points_total) * 100) 
                                : 0;
                            
                            return `
                                <div class="border-l-4 border-blue-500 pl-4">
                                    <p class="font-bold">Mission ${m.mission_id} - ${m.centrale_nom}</p>
                                    <p class="text-sm text-gray-600">
                                        <strong>${m.nb_points_completes}/${m.nb_points_total}</strong> points 
                                        (${progression}%) - 
                                        ${m.nb_photos || 0} photos
                                    </p>
                                    <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                        <div class="bg-blue-600 h-2 rounded-full" style="width: ${progression}%"></div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p class="text-red-600">‚ùå Erreur: ${error.message}</p>`;
            }
        }
        
        // Charger automatiquement au d√©marrage
        window.addEventListener('DOMContentLoaded', testAPI);
    </script>
</body>
</html>
